services:
    _defaults:
        autowire: true
        autoconfigure: true

    Rika\SyliusBrandPlugin\:
        resource: '../../*'
        exclude: '../../{DependencyInjection,Entity,Tests,Form}'

    Rika\SyliusBrandPlugin\Controller\:
        resource: '../../Controller'
        tags: ['controller.service_arguments']

    # Factory pour Brand - Configuration corrigée
    rika_sylius_brand.factory.brand:
        class: Rika\SyliusBrandPlugin\Factory\BrandFactory
        arguments:
            - !service
                class: Sylius\Resource\Factory\Factory
                arguments:
                    - 'Rika\SyliusBrandPlugin\Entity\Brand'
            - '@sylius.context.locale'

    # Factory pour BrandTranslation
    rika_sylius_brand.factory.brand_translation:
        class: Sylius\Resource\Factory\Factory
        arguments:
            - 'Rika\SyliusBrandPlugin\Entity\BrandTranslation'

    # Repository
    rika_sylius_brand.repository.brand:
        class: Rika\SyliusBrandPlugin\Repository\BrandRepository
        arguments:
            - '@doctrine.orm.default_entity_manager'
            - !service
                class: Doctrine\ORM\Mapping\ClassMetadata
                factory: ['@doctrine.orm.default_entity_manager', getClassMetadata]
                arguments:
                    - 'Rika\SyliusBrandPlugin\Entity\Brand'

    # Event listeners
    Rika\SyliusBrandPlugin\EventListener\BrandEventListener:
        arguments:
            $uploadDir: '%rika_sylius_brand.upload_dir%'
        tags:
            - { name: kernel.event_listener, event: 'rika_sylius_brand.brand.pre_create', method: uploadLogo }
            - { name: kernel.event_listener, event: 'rika_sylius_brand.brand.pre_update', method: uploadLogo }

    Rika\SyliusBrandPlugin\EventListener\ProductMappingListener:
        tags:
            - { name: doctrine.event_subscriber, priority: 100 }

    Rika\SyliusBrandPlugin\Menu\AdminMenuListener:
        tags:
            - { name: kernel.event_listener, event: sylius.menu.admin.main, method: __invoke }

    # Form types
    Rika\SyliusBrandPlugin\Form\Type\BrandType:
        arguments:
            $dataClass: 'Rika\SyliusBrandPlugin\Entity\Brand'
            $validationGroups: ['sylius']
        tags:
            - { name: 'form.type' }

    Rika\SyliusBrandPlugin\Form\Type\BrandTranslationType:
        arguments:
            $dataClass: 'Rika\SyliusBrandPlugin\Entity\BrandTranslation'
            $validationGroups: ['sylius']
        tags:
            - { name: 'form.type' }

    Rika\SyliusBrandPlugin\Form\Type\BrandChoiceType:
        tags:
            - { name: 'form.type' }

    # Form extensions
    Rika\SyliusBrandPlugin\Form\Extension\:
        resource: '../../Form/Extension'
        tags: ['form.type_extension']

# Paramètres
parameters:
    rika_sylius_brand.upload_dir: '%kernel.project_dir%/public/media/brand'

# Configuration des ressources Sylius
sylius_resource:
    resources:
        rika_sylius_brand.brand:
            driver: doctrine/orm
            classes:
                model: Rika\SyliusBrandPlugin\Entity\Brand
                repository: Rika\SyliusBrandPlugin\Repository\BrandRepository
                factory: rika_sylius_brand.factory.brand
                form: Rika\SyliusBrandPlugin\Form\Type\BrandType
            translation:
                classes:
                    model: Rika\SyliusBrandPlugin\Entity\BrandTranslation
                    factory: rika_sylius_brand.factory.brand_translation
                    form: Rika\SyliusBrandPlugin\Form\Type\BrandTranslationType

# Configuration de la grille
sylius_grid:
    grids:
        rika_sylius_brand_admin_brand:
            driver:
                name: doctrine/orm
                options:
                    class: Rika\SyliusBrandPlugin\Entity\Brand
            sorting:
                position: asc
            fields:
                logo:
                    type: twig
                    label: rika_sylius_brand.ui.logo
                    sortable: false
                    options:
                        template: "@RikaSyliusBrandPlugin/Admin/Brand/Grid/Field/logo.html.twig"
                code:
                    type: string
                    label: sylius.ui.code
                    sortable: true
                name:
                    type: string
                    label: sylius.ui.name
                    sortable: true
                    path: name
                enabled:
                    type: twig
                    label: sylius.ui.enabled
                    sortable: true
                    options:
                        template: "@SyliusUi/Grid/Field/enabled.html.twig"
                position:
                    type: string
                    label: rika_sylius_brand.ui.position
                    sortable: true
            filters:
                search:
                    type: string
                    label: sylius.ui.search
                    options:
                        fields: [code, translation.name]
                enabled:
                    type: boolean
                    label: sylius.ui.enabled
            actions:
                main:
                    create:
                        type: create
                item:
                    update:
                        type: update
                    delete:
                        type: delete
